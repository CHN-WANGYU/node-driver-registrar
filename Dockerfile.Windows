ARG ADDON_IMAGE=servercore:1809
ARG BASE_IMAGE=nanoserver:1809
ARG REGISTRY=mcr.microsoft.com/windows

FROM ${REGISTRY}/${ADDON_IMAGE} as addon
FROM ${REGISTRY}/${BASE_IMAGE}
LABEL description="CSI Node driver registrar"

COPY ./bin/csi-node-driver-registrar.exe /csi-node-driver-registrar.exe
COPY --from=addon /Windows/System32/netapi32.dll /Windows/System32/netapi32.dll

USER ContainerAdministrator
ENTRYPOINT ["/csi-node-driver-registrar.exe"]
